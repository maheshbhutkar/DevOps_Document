try {
AJS.$(function(g){var b=AJS.params.contextPath,f="Error retrieving attachment versions.",c=AJS.DragAndDropUtils&&AJS.DragAndDropUtils.hasXhrSupport;function d(i){var j={};i.find("input").each(function(){j[this.name]=this.value});return j}function h(j){var i=j.closest(".plugin_attachments_table_container");var k={};k.attachmentId=j.data("attachment-id");k.decorator="none";g.ajax({cache:false,data:k,dataType:"html",type:"GET",url:b+"/pages/plugins/attachments/loadattachmentversions.action",success:function(m){var l=g(m);AJS.Labels.bindOpenDialog(g(".show-labels-editor",l));var n=j.next().find(".attachment-history-wrapper");n.empty();n.append(l)},error:function(l,o,m){AJS.log("Error retrieving attachment old versions: "+m);var n=i.parent(".plugin_attachments_container");i.remove();g("div.plugin_attachments_upload_container",n).remove();n.append('<div class="attachments-old-version-error error">'+f+"</div>")}})}var a={getFieldSetAsParams:d,initAttachmentTable:function(i){g(".attachment-menu-bar .ajs-menu-item").unbind();g(".attachment-menu-bar").ajsMenu();g(".attachments .attachment-row .attachment-dropdown-actions .action-dropdown",i).addClass("hide-menu");g(".attachments .attachment-row .attachment-dropdown-actions .action-dropdown .aui-dd-parent .aui-dropdown",i).addClass("hidden");g(".attachments .attachment-dropdown-actions span",i).addClass("hide-icons");AJS.Labels.bindOpenDialog(g(".show-labels-editor",i));var j=this.getFieldSetAsParams(i.children("fieldset"));g(".attachments .attachment-row",i).hover(function(){var k=g(this);if(!k.is(".focused")){k.addClass("hovered")}k.find("span").toggleClass("hide-icons hide-menu",false);k.find(".attachment-dropdown-actions .action-dropdown").dropDown("Standard",{alignment:"right"});k.find("a.aui-dropdown2-trigger").show()},function(){var k=g(this);k.removeClass("hovered");var l=k.is(".focused");k.find("span").toggleClass("hide-icons",!l);k.find("a.aui-dropdown2-trigger").toggle(l)}).on("click",function(n){if(g(n.target).is("a")){return}var l=g(this).find(".attachment-summary-toggle .icon");l.toggleClass("icon-section-opened icon-section-closed");l.closest("tr").next().toggleClass("hidden");if(l.is(".icon-section-opened")){var k=l.closest("tr");var m=k.data("attachment-id");if(!i.find("tr.history-"+m).length&&k.next().find(".attachment-history-wrapper").length){h(k)}}});g(".attachments .action-trigger",i).click(function(){var k=g(this).parents("tr:first")[0].id;g(".attachments .attachment-row",i).each(function(){var l=g(this);var m=l[0].id;if(m==k){l.addClass("focused");g("span",l).removeClass("hide-icons");g("a.aui-dropdown2-trigger",l).show()}else{if(l.hasClass("focused")){l.removeClass("focused");g("span",l).addClass("hide-icons");g("a.aui-dropdown2-trigger",l).hide()}}g(".attachment-dropdown-actions .action-dropdown",l).dropDown("Standard",{alignment:"right"})})});g(".attachment-image-preview .attachment-image",i).fancybox()},markFileCommentFieldModified:function(i){if(i.hasClass("blank-search")){i.removeClass("blank-search");i.val("")}},initAttachmentCommentTextFields:function(i){i.find("input[name^='comment_']").each(function(){g(this).focus(function(){a.markFileCommentFieldModified(g(this))})})},renameForms:function(){var i=self.placeFocus;if(i){self.placeFocus=function(){var j=g("div.plugin_attachments_upload_container form");j.attr("name","inlinecommentform");i();j.removeAttr("name")}}},refreshOtherAttachmentsMacroInstances:function(k,i,j){g("div.plugin_attachments_table_container > fieldset").each(function(){var o=g(this);var l=g("input[name='pageId']",o).val();if(l!=k){return}var m=g(this).clone();g("input",m).each(function(){if(!g(this).hasClass("plugin_attachments_macro_render_param")){g(this).remove()}});var n=a.getFieldSetAsParams(m);n.old=n.old||"true";g.ajax({cache:false,type:"GET",url:b+"/pages/plugins/attachments/rendermacro.action",data:n,success:function(r){var p=o.parent();var q=g(r).find("div.plugin_attachments_table_container").html();p.fadeOut("normal",function(){p.html(q);a.initAttachmentTable(p)});p.fadeIn("normal",function(){AJS.Labels.bindOpenDialog(AJS.$(".show-labels-editor",p))});if(i){i()}},error:function(){if(j){j()}}})})},initAuiMessageBar:function(){if(!g("#aui-message-bar").length){g("#com-atlassian-confluence").append('<div id="aui-message-bar"></div>')}},initUploadForm:function(m){this.initAttachmentCommentTextFields(m);this.initAuiMessageBar();var l=m.children("iframe.plugin_attachments_uploadiframe");var k=m.find("input[name='confirm']");m.find("input[name='file_0']").val("");var i;if(!c){k.after("<img src='"+b+"/images/icons/wait.gif' class='plugin_attachments_uploadwaiticon'/>");i=k.next("img.plugin_attachments_uploadwaiticon")}else{i=g("img.plugin_attachments_dropzone_uploadwaiticon")}var j=a.getFieldSetAsParams(m.parents("div.plugin_attachments_upload_container").prev("div.plugin_attachments_table_container").children("fieldset"));g("#browse-files").on("click",function(){var n=m.find("input[name='file_0']");n.click();n.on("change",function(){if(n.val()!=""){m.submit()}})});m.submit(function(){if(j.outputType=="preview"){return false}m.find("input[name^='comment_']").each(function(){a.markFileCommentFieldModified(g(this))});var n=this;n.target=l.attr("name");k.addClass("hidden");i.css("visibility","visible");l.get(0).processUpload=true;return true});l.load(function(){if(!this.processUpload){return}var q=this.contentWindow||this.contentDocument;q=q.document?q.document:q;var p=q.body;var o=g(p);var n=o.find("div.aui-message.error");if(n.length>0&&g.trim(n.html()).length>0){AJS.messages.error("#aui-message-bar",{body:n.html()});setTimeout(function(){g(".aui-message.error").remove()},3000);i.css("visibility","hidden");k.removeClass("hidden")}else{a.refreshOtherAttachmentsMacroInstances(j.pageId,function(){i.css("visibility","hidden");k.removeClass("hidden");location.reload()},function(){AJS.messages.error("#aui-message-bar",{body:j["i18n-notpermitted"]});setTimeout(function(){g(".aui-message.error").remove()},3000);i.css("visibility","hidden");k.removeClass("hidden")});m.find("input[name='file_0']").replaceWith(g('<input type="file" name="file_0" size="30">'));m.find("input[name^='comment_']").val("")}})},hideDropdownIcons:function(){g(".attachments .attachment-row").each(function(){var i=g(this);if(i.hasClass("focused")){i.removeClass("focused");g("span",i).addClass("hide-icons")}})}};g("body").click(function(j){var i=g(j.target);if(i.parents("td").length&&!i.parents("td").hasClass("attachment-dropdown-actions")){a.hideDropdownIcons()}});g("div.plugin_attachments_table_container").each(function(){var i=g(this);a.initAttachmentTable(i)});var e=g("li.drop-zone-text");if(g.browser.msie){e.find("span").text(AJS.$.trim(e.text()));g("form.plugin_attachments_uploadform").removeClass("hidden")}if(c){e.removeClass("hidden")}g("form.plugin_attachments_uploadform").each(function(){a.initUploadForm(g(this))});g(".plugin_attachments_table_container").on("click",".removeAttachmentLink",function(){if(AJS.Attachments.showRemoveAttachmentConfirmDialog){AJS.Attachments.showRemoveAttachmentConfirmDialog(this);return false}});a.renameForms();AJS.bind("attachment-macro.refresh",function(j,i){a.refreshOtherAttachmentsMacroInstances(i)})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


